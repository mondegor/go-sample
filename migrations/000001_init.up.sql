-- --------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------

CREATE SCHEMA gs_catalog AUTHORIZATION user_pg;

-- --------------------------------------------------------------------------------------------------

CREATE TABLE gs_catalog.categories (
    category_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_categories PRIMARY KEY,
    tag_version int4 NOT NULL DEFAULT 1 CHECK(tag_version > 0),
    datetime_created timestamp NOT NULL DEFAULT now(),
    datetime_updated timestamp NULL,
    category_caption character varying(128) NOT NULL,
    image_meta jsonb DEFAULT NULL,
    category_status int2 NOT NULL -- 1=DRAFT, 2=ENABLED, 3=DISABLED, 4=REMOVED
);

INSERT INTO gs_catalog.categories (category_id, tag_version, datetime_created, datetime_updated, category_caption, image_meta, category_status)
VALUES
    (1, 1, '2023-01-01 12:15:59.981966', NULL, 'Электроника', NULL, 2/*ENABLED*/),
    (2, 1, '2023-02-01 13:15:08.678538', NULL, 'Бытовая техника', NULL, 2/*ENABLED*/),
    (3, 1, '2023-03-01 14:15:16.078388', NULL, 'Компьютерная техника', NULL, 1/*DRAFT*/),
    (4, 1, '2023-04-01 15:15:12.319733', NULL, 'Строительство и ремонт', NULL, 2/*ENABLED*/),
    (5, 1, '2023-05-01 16:15:14.319733', NULL, 'Кондитерские изделия', NULL, 2/*ENABLED*/),
    (6, 1, '2023-06-01 17:15:32.319733', NULL, 'Увлажнители воздуха', NULL, 3/*DISABLED*/),
    (7, 1, '2023-07-01 18:15:23.319733', NULL, 'Тостеры и ростеры', NULL, 1/*DRAFT*/),
    (8, 1, '2023-08-01 19:15:19.319733', NULL, 'Сварочные аппараты', NULL, 2/*ENABLED*/);

ALTER SEQUENCE gs_catalog.categories_category_id_seq RESTART WITH 9;

-- --------------------------------------------------------------------------------------------------

CREATE TABLE gs_catalog.trademarks (
    trademark_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_trademarks PRIMARY KEY,
    tag_version int4 NOT NULL DEFAULT 1 CHECK(tag_version > 0),
    datetime_created timestamp NOT NULL DEFAULT now(),
    datetime_updated timestamp NULL,
    trademark_caption character varying(64) NOT NULL,
    trademark_status int2 NOT NULL -- 1=DRAFT, 2=ENABLED, 3=DISABLED, 4=REMOVED
);

INSERT INTO gs_catalog.trademarks (trademark_id, tag_version, datetime_created, datetime_updated, trademark_caption, trademark_status)
VALUES
    (1, 1, '2023-01-01 12:10:59.981966', NULL, 'Алёнка', 2/*ENABLED*/),
    (2, 1, '2023-02-01 13:10:08.678538', NULL, 'Маша и Медведь', 3/*DISABLED*/),
    (3, 1, '2023-03-01 14:10:16.078388', NULL, 'Юбилейное', 2/*ENABLED*/),
    (4, 1, '2023-04-01 15:10:23.319733', NULL, 'Бабаевский', 2/*ENABLED*/),
    (5, 1, '2023-05-01 16:10:23.319733', NULL, 'Кара-Кум', 1/*DRAFT*/),
    (6, 1, '2023-06-01 17:10:14.319733', NULL, 'Мишка на Севере', 2/*ENABLED*/),
    (7, 1, '2023-07-01 18:10:23.319733', NULL, 'Радуга ТВ', 2/*ENABLED*/),
    (8, 1, '2023-08-01 19:10:45.319733', NULL, 'Ракета', 1/*DRAFT*/);

ALTER SEQUENCE gs_catalog.trademarks_trademark_id_seq RESTART WITH 9;

-- --------------------------------------------------------------------------------------------------

CREATE TABLE gs_catalog.products (
    product_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_products PRIMARY KEY,
    tag_version int4 NOT NULL DEFAULT 1 CHECK(tag_version > 0),
    datetime_created timestamp NOT NULL DEFAULT now(),
    datetime_updated timestamp NULL,
    category_id int4 NOT NULL CONSTRAINT FK_products_category_id REFERENCES gs_catalog.categories (category_id),
    product_article character varying(32) NULL CONSTRAINT UK_products_product_article UNIQUE,
    product_caption character varying(128) NOT NULL,
    trademark_id int4 NOT NULL CONSTRAINT FK_products_trademark_id REFERENCES gs_catalog.trademarks (trademark_id),
    product_price int8 NOT NULL, -- coins * 100
    product_status int2 NOT NULL, -- 1=DRAFT, 2=ENABLED, 3=DISABLED, 4=REMOVED
    prev_field_id int4 NULL CHECK(prev_field_id IS NULL OR prev_field_id > 0),
    next_field_id int4 NULL CHECK(next_field_id IS NULL OR next_field_id > 0),
    order_field int8 NULL CHECK(order_field IS NULL OR order_field > 0)
);

INSERT INTO gs_catalog.products (product_id, tag_version, datetime_created, datetime_updated, category_id, product_article, product_caption, trademark_id, product_price, product_status, prev_field_id, next_field_id, order_field)
VALUES
    (1, 1, '2023-01-01 12:30:59.981966', NULL, 5, 'candy-001', 'Алёнка', 1, 9050, 2/*ENABLED*/, NULL, 2, 1000),
    (2, 1, '2023-02-01 13:30:08.678538', NULL, 8, 'masha-002', 'Маша и Медведь', 2, 5380000, 2/*ENABLED*/, NULL, NULL, NULL),
    (3, 1, '2023-03-01 14:30:16.078388', NULL, 5, 'cookie-003', 'Юбилейное', 3, 4300, 2/*ENABLED*/, 1, 4, 2000),
    (4, 1, '2023-04-01 15:30:23.319733', NULL, 5, 'candy-004', 'Бабаевский', 4, 12570, 2/*ENABLED*/, 3, 5, 3000),
    (5, 1, '2023-05-01 16:30:23.319733', NULL, 5, 'candy-005', 'Кара-Кум', 5, 5000, 1/*DRAFT*/, 4, 6, 4000),
    (6, 1, '2023-06-01 17:30:14.319733', NULL, 5, 'candy-006', 'Мишка на Севере', 6, 21450, 2/*ENABLED*/, 5, NULL, 5000),
    (7, 1, '2023-07-01 18:30:23.319733', NULL, 1, 'tv-007', 'Радуга ТВ', 7, 2000000, 2/*ENABLED*/, NULL, 8, 1000),
    (8, 1, '2023-08-01 19:30:45.319733', NULL, 1, 'rocket-008', 'Ракета', 8, 1530000, 1/*DRAFT*/, 8, NULL, 2000);

CREATE INDEX IX_products_category_id_order_field ON gs_catalog.products (category_id, order_field);

ALTER SEQUENCE gs_catalog.products_product_id_seq RESTART WITH 9;

-- --------------------------------------------------------------------------------------------------