CREATE SCHEMA gosample AUTHORIZATION user_pg;

-- --------------------------------------------------------------------------------------------------

CREATE TYPE gosample.item_status AS ENUM (
    'DRAFT',
    'ENABLED',
    'DISABLED',
    'REMOVED');

-- --------------------------------------------------------------------------------------------------

CREATE TABLE gosample.catalog_categories (
    category_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_catalog_categories PRIMARY KEY,
    tag_version int4 NOT NULL DEFAULT 1 CHECK(tag_version > 0),
    datetime_created timestamp NOT NULL DEFAULT now(),
    datetime_updated timestamp NULL,
    category_caption character varying(128) NOT NULL,
    image_path character varying(128) NOT NULL DEFAULT '',
    category_status gosample.item_status NOT NULL
);

INSERT INTO gosample.catalog_categories (category_id, tag_version, datetime_created, datetime_updated, category_caption, image_path, category_status)
VALUES
    (1, 1, '2023-01-01 12:15:59.981966', NULL, 'Электроника', '', 'ENABLED'),
    (2, 1, '2023-02-01 13:15:08.678538', NULL, 'Бытовая техника', '', 'ENABLED'),
    (3, 1, '2023-03-01 14:15:16.078388', NULL, 'Компьютерная техника', '', 'DRAFT'),
    (4, 1, '2023-04-01 15:15:12.319733', NULL, 'Строительство и ремонт', '', 'ENABLED'),
    (5, 1, '2023-05-01 16:15:14.319733', NULL, 'Кондитерские изделия', '', 'ENABLED'),
    (6, 1, '2023-06-01 17:15:32.319733', NULL, 'Увлажнители воздуха', '', 'DISABLED'),
    (7, 1, '2023-07-01 18:15:23.319733', NULL, 'Тостеры и ростеры', '', 'DRAFT'),
    (8, 1, '2023-08-01 19:15:19.319733', NULL, 'Сварочные аппараты', '', 'ENABLED');

ALTER SEQUENCE gosample.catalog_categories_category_id_seq RESTART WITH 9;

-- --------------------------------------------------------------------------------------------------

CREATE TABLE gosample.catalog_trademarks (
    trademark_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_catalog_trademarks PRIMARY KEY,
    tag_version int4 NOT NULL DEFAULT 1 CHECK(tag_version > 0),
    datetime_created timestamp NOT NULL DEFAULT now(),
    datetime_updated timestamp NULL,
    trademark_caption character varying(64) NOT NULL,
    trademark_status gosample.item_status NOT NULL
);

INSERT INTO gosample.catalog_trademarks (trademark_id, tag_version, datetime_created, datetime_updated, trademark_caption, trademark_status)
VALUES
    (1, 1, '2023-01-01 12:10:59.981966', NULL, 'Алёнка', 'ENABLED'),
    (2, 1, '2023-02-01 13:10:08.678538', NULL, 'Маша и Медведь', 'DISABLED'),
    (3, 1, '2023-03-01 14:10:16.078388', NULL, 'Юбилейное', 'ENABLED'),
    (4, 1, '2023-04-01 15:10:23.319733', NULL, 'Бабаевский', 'ENABLED'),
    (5, 1, '2023-05-01 16:10:23.319733', NULL, 'Кара-Кум', 'DRAFT'),
    (6, 1, '2023-06-01 17:10:14.319733', NULL, 'Мишка на Севере', 'ENABLED'),
    (7, 1, '2023-07-01 18:10:23.319733', NULL, 'Радуга ТВ', 'ENABLED'),
    (8, 1, '2023-08-01 19:10:45.319733', NULL, 'Ракета', 'DRAFT');

ALTER SEQUENCE gosample.catalog_trademarks_trademark_id_seq RESTART WITH 9;

-- --------------------------------------------------------------------------------------------------

CREATE TABLE gosample.catalog_products (
    product_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_catalog_products PRIMARY KEY,
    tag_version int4 NOT NULL DEFAULT 1 CHECK(tag_version > 0),
    datetime_created timestamp NOT NULL DEFAULT now(),
    datetime_updated timestamp NULL,
    category_id int4 NOT NULL CONSTRAINT "FK_catalog_products_category_id" REFERENCES gosample.catalog_categories(category_id),
    trademark_id int4 NOT NULL CONSTRAINT "FK_catalog_products_trademark_id" REFERENCES gosample.catalog_trademarks(trademark_id),
    product_article character varying(32) NULL CONSTRAINT UK_catalog_products_product_article UNIQUE,
    product_caption character varying(128) NOT NULL,
    product_price int8 NOT NULL, -- coins * 100
    product_status gosample.item_status NOT NULL,
    prev_field_id int4 NULL CHECK(prev_field_id IS NULL OR prev_field_id > 0),
    next_field_id int4 NULL CHECK(next_field_id IS NULL OR next_field_id > 0),
    order_field int8 NULL CHECK(order_field IS NULL OR order_field > 0)
);

INSERT INTO gosample.catalog_products (product_id, tag_version, datetime_created, datetime_updated, category_id, trademark_id, product_article, product_caption, product_price, product_status, prev_field_id, next_field_id, order_field)
VALUES
    (1, 1, '2023-01-01 12:30:59.981966', NULL, 5, 1, 'candy-001', 'Алёнка', 9050, 'ENABLED', NULL, 2, 1000),
    (2, 1, '2023-02-01 13:30:08.678538', NULL, 8, 2, 'masha-002', 'Маша и Медведь', 5380000, 'ENABLED', NULL, NULL, NULL),
    (3, 1, '2023-03-01 14:30:16.078388', NULL, 5, 3, 'cookie-003', 'Юбилейное', 4300, 'ENABLED', 1, 4, 2000),
    (4, 1, '2023-04-01 15:30:23.319733', NULL, 5, 4, 'candy-004', 'Бабаевский', 12570, 'ENABLED', 3, 5, 3000),
    (5, 1, '2023-05-01 16:30:23.319733', NULL, 5, 5, 'candy-005', 'Кара-Кум', 5000, 'DRAFT', 4, 6, 4000),
    (6, 1, '2023-06-01 17:30:14.319733', NULL, 5, 6, 'candy-006', 'Мишка на Севере', 21450, 'ENABLED', 5, NULL, 5000),
    (7, 1, '2023-07-01 18:30:23.319733', NULL, 1, 7, 'tv-007', 'Радуга ТВ', 2000000, 'ENABLED', NULL, 8, 1000),
    (8, 1, '2023-08-01 19:30:45.319733', NULL, 1, 8, 'rocket-008', 'Ракета', 1530000, 'DRAFT', 8, NULL, 2000);

CREATE INDEX IX_catalog_products_category_id_order_field ON gosample.catalog_products (category_id, order_field);

-- ALTER SEQUENCE gosample.catalog_products_product_id_seq RESTART WITH 1;

-- --------------------------------------------------------------------------------------------------