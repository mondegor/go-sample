-- --------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------

CREATE SCHEMA sample_catalog AUTHORIZATION user_pg;

-- --------------------------------------------------------------------------------------------------

CREATE TABLE sample_catalog.categories (
    category_id uuid NOT NULL CONSTRAINT pk_categories PRIMARY KEY,
    tag_version int4 NOT NULL DEFAULT 1 CHECK(tag_version > 0),
    category_caption character varying(128) NOT NULL,
    image_meta jsonb DEFAULT NULL,
    category_status int2 NOT NULL, -- 1=DRAFT, 2=ENABLED, 3=DISABLED
    created_at timestamp with time zone NOT NULL DEFAULT NOW(),
    updated_at timestamp with time zone NULL,
    deleted_at timestamp with time zone NULL
);

INSERT INTO sample_catalog.categories (category_id, tag_version, category_caption, image_meta, category_status, created_at, updated_at, deleted_at)
VALUES
    ('b86555ab-9320-4680-b62d-1ea449550fff', 1, 'Электроника', NULL, 2/*ENABLED*/, '2023-01-01 12:15:59.981966', NULL, NULL),
    ('166a72b5-b9fa-499c-8140-3627b34acbbe', 1, 'Бытовая техника', NULL, 2/*ENABLED*/, '2023-02-01 13:15:08.678538', NULL, NULL),
    ('3979b1bb-26ba-4a57-b9ee-fd723b4fa9a0', 1, 'Компьютерная техника', NULL, 1/*DRAFT*/, '2023-03-01 14:15:16.078388', NULL, NULL),
    ('75b3e9ea-7c07-4bbb-a8b1-adb02ebcbbec', 1, 'Строительство и ремонт', NULL, 2/*ENABLED*/, '2023-04-01 15:15:12.319733', NULL, NULL),
    ('0a2b96df-a528-4081-8c76-3280ffba320e', 1, 'Кондитерские изделия', NULL, 2/*ENABLED*/, '2023-05-01 16:15:14.319733', NULL, NULL),
    ('d1c7ddd8-6d48-4008-be0e-d4170ef62f1c', 1, 'Увлажнители воздуха', NULL, 3/*DISABLED*/, '2023-06-01 17:15:32.319733', NULL, NULL),
    ('fb0ebfa1-d264-46d0-a377-c3b8f67b01a3', 1, 'Тостеры и ростеры', NULL, 1/*DRAFT*/, '2023-07-01 18:15:23.319733', NULL, NULL),
    ('af6f7154-6ecc-4734-983b-1b91a866a6bc', 1, 'Сварочные аппараты', NULL, 2/*ENABLED*/, '2023-08-01 19:15:19.319733', NULL, NULL);

-- --------------------------------------------------------------------------------------------------

CREATE TABLE sample_catalog.trademarks (
    trademark_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY CONSTRAINT pk_trademarks PRIMARY KEY,
    tag_version int4 NOT NULL DEFAULT 1 CHECK(tag_version > 0),
    trademark_caption character varying(64) NOT NULL,
    trademark_status int2 NOT NULL, -- 1=DRAFT, 2=ENABLED, 3=DISABLED
    created_at timestamp with time zone NOT NULL DEFAULT NOW(),
    updated_at timestamp with time zone NULL,
    deleted_at timestamp with time zone NULL
);

INSERT INTO sample_catalog.trademarks (trademark_id, tag_version, trademark_caption, trademark_status, created_at, updated_at, deleted_at)
VALUES
    (1, 1, 'Алёнка', 2/*ENABLED*/, '2023-01-01 12:10:59.981966', NULL, NULL),
    (2, 1, 'Маша и Медведь', 3/*DISABLED*/, '2023-02-01 13:10:08.678538', NULL, NULL),
    (3, 1, 'Юбилейное', 2/*ENABLED*/, '2023-03-01 14:10:16.078388', NULL, NULL),
    (4, 1, 'Бабаевский', 2/*ENABLED*/, '2023-04-01 15:10:23.319733', NULL, NULL),
    (5, 1, 'Кара-Кум', 1/*DRAFT*/, '2023-05-01 16:10:23.319733', NULL, NULL),
    (6, 1, 'Мишка на Севере', 2/*ENABLED*/, '2023-06-01 17:10:14.319733', NULL, NULL),
    (7, 1, 'Радуга ТВ', 2/*ENABLED*/, '2023-07-01 18:10:23.319733', NULL, NULL),
    (8, 1, 'Ракета', 1/*DRAFT*/, '2023-08-01 19:10:45.319733', NULL, NULL);

ALTER SEQUENCE sample_catalog.trademarks_trademark_id_seq RESTART WITH 9;

-- --------------------------------------------------------------------------------------------------

CREATE TABLE sample_catalog.products (
    product_id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY CONSTRAINT pk_products PRIMARY KEY,
    tag_version int4 NOT NULL DEFAULT 1 CHECK(tag_version > 0),
    category_id uuid NOT NULL CONSTRAINT fk_products_category_id REFERENCES sample_catalog.categories (category_id),
    product_article character varying(32) NULL,
    product_caption character varying(128) NOT NULL,
    trademark_id int4 NOT NULL CONSTRAINT fk_products_trademark_id REFERENCES sample_catalog.trademarks (trademark_id),
    product_price int8 NOT NULL, -- coins * 100
    product_status int2 NOT NULL, -- 1=DRAFT, 2=ENABLED, 3=DISABLED
    created_at timestamp with time zone NOT NULL DEFAULT NOW(),
    updated_at timestamp with time zone NULL,
    deleted_at timestamp with time zone NULL,
    prev_field_id int4 NULL CHECK(prev_field_id IS NULL OR prev_field_id > 0),
    next_field_id int4 NULL CHECK(next_field_id IS NULL OR next_field_id > 0),
    order_index int8 NULL CHECK(order_index IS NULL OR order_index > 0)
);

CREATE UNIQUE INDEX uk_products_product_article ON sample_catalog.products (product_article) WHERE deleted_at IS NULL;

INSERT INTO sample_catalog.products (product_id, tag_version, category_id, product_article, product_caption, trademark_id, product_price, product_status, created_at, updated_at, deleted_at, prev_field_id, next_field_id, order_index)
VALUES
    (1, 1, '0a2b96df-a528-4081-8c76-3280ffba320e', 'candy-001', 'Алёнка', 1, 9050, 2/*ENABLED*/, '2023-01-01 12:30:59.981966', NULL, NULL, NULL, 3, 1000),
    (2, 1, 'af6f7154-6ecc-4734-983b-1b91a866a6bc', 'masha-002', 'Маша и Медведь', 2, 5380000, 2/*ENABLED*/, '2023-02-01 13:30:08.678538', NULL, NULL, NULL, NULL, NULL),
    (3, 1, '0a2b96df-a528-4081-8c76-3280ffba320e', 'cookie-003', 'Юбилейное', 3, 4300, 2/*ENABLED*/, '2023-03-01 14:30:16.078388', NULL, NULL, 1, 4, 2000),
    (4, 1, '0a2b96df-a528-4081-8c76-3280ffba320e', 'candy-004', 'Бабаевский', 4, 12570, 2/*ENABLED*/, '2023-04-01 15:30:23.319733', NULL, NULL, 3, 5, 3000),
    (5, 1, '0a2b96df-a528-4081-8c76-3280ffba320e', 'candy-005', 'Кара-Кум', 5, 5000, 1/*DRAFT*/, '2023-05-01 16:30:23.319733', NULL, NULL, 4, 6, 4000),
    (6, 1, '0a2b96df-a528-4081-8c76-3280ffba320e', 'candy-006', 'Мишка на Севере', 6, 21450, 2/*ENABLED*/, '2023-06-01 17:30:14.319733', NULL, NULL, 5, NULL, 5000),
    (7, 1, 'b86555ab-9320-4680-b62d-1ea449550fff', 'tv-007', 'Радуга ТВ', 7, 2000000, 2/*ENABLED*/, '2023-07-01 18:30:23.319733', NULL, NULL, NULL, 8, 1000),
    (8, 1, 'b86555ab-9320-4680-b62d-1ea449550fff', 'rocket-008', 'Ракета', 8, 1530000, 1/*DRAFT*/, '2023-08-01 19:30:45.319733', NULL, NULL, 8, NULL, 2000);

CREATE INDEX ix_products_category_id_order_index ON sample_catalog.products (category_id, order_index) WHERE deleted_at IS NULL;

ALTER SEQUENCE sample_catalog.products_product_id_seq RESTART WITH 9;

-- --------------------------------------------------------------------------------------------------